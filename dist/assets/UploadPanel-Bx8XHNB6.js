import{j as e,s as k}from"./index-CUvJq98-.js";import{r as b}from"./vendor-nf7bT_Uh.js";import{u as M,m as R,b as D}from"./usePrefersReducedMotion-D4_4BgCp.js";function S(n,w){const o=[];let l="",t=0;const d=n.length;let m=!1;for(;t<d;){const c=n[t];if(m)if(c==='"')if(t+1<d&&n[t+1]==='"'){l+='"',t+=2;continue}else{m=!1,t++;continue}else{l+=c,t++;continue}else{if(c==='"'){m=!0,t++;continue}if(c===w){o.push(l),l="",t++;continue}if(c==="\r"){t++;continue}l+=c,t++}}return o.push(l),o}function F(n){return n.trim().replace(/\uFEFF/g,"").replace(/\s+/g," ").replace(/[_\-]+/g," ").replace(/[:]/g,"").toLowerCase()}function E(n){return n.includes("	")?"	":","}function V(n){if(!n||!n.trim())return{rows:[],sessionNames:[],errors:["CSV is empty"]};const o=n.replace(/^\uFEFF/,"").split(/\n/);if(o.length<2)return{rows:[],sessionNames:[],errors:["CSV must have a header and at least one data row"]};const l=o[0].replace(/\r$/,""),t=E(l),d=S(l,t).map(r=>r.trim()),m={Day:["day","date"],Exercise:["exercise","workout","name"],Sets:["sets","set"],"Reps or Time":["reps or time","reps/time","reps time","time","duration","reps"],Weight:["weight","load","kg","lbs"],Notes:["notes","note","comments"],"Form Guidance":["form guidance","form","guidance","cues","form cues"],"Muscle Group":["muscle group","muscle groups","group"],"Main Muscle":["main muscle","primary muscle","target"],"Day Type":["day type","type"]},c=new Map;d.forEach((r,s)=>c.set(F(r),s));const f={},h=[];function j(r){for(const s of r){const i=c.get(F(s));if(i!==void 0)return i}}const x=["Day","Exercise","Sets","Reps or Time","Weight"];Object.entries(m).forEach(([r,s])=>{const i=j([r,...s]);f[r]=i});const g=x.filter(r=>f[r]===void 0);if(g.length)return h.push(`Missing required headers: ${g.join(", ")}. Found headers: ${d.join(" | ")}`),{rows:[],sessionNames:[],errors:h};const N=[],y=new Set;for(let r=1;r<o.length;r++){const s=o[r];if(!s||!s.trim())continue;const i=S(s.replace(/\r$/,""),t).map(p=>p.trim()),a=p=>{const v=f[p];return typeof v=="number"&&v>=0&&v<i.length?i[v]??"":""},u={Day:a("Day"),Exercise:a("Exercise"),Sets:a("Sets"),"Reps or Time":a("Reps or Time"),Weight:a("Weight"),Notes:a("Notes"),"Form Guidance":a("Form Guidance"),"Muscle Group":a("Muscle Group"),"Main Muscle":a("Main Muscle"),"Day Type":a("Day Type")};if(!u.Day&&!u.Exercise)continue;const C=[];for(const p of x)(!u[p]||u[p].length===0)&&C.push(p);C.length&&h.push(`Row ${r+1}: missing ${C.join(", ")}`),N.push(u),u.Day&&y.add(u.Day)}return{rows:N,sessionNames:Array.from(y).sort(),errors:h}}function G({onSuccess:n,onCancel:w,isReupload:o,onReplaceConfirm:l}){const[t,d]=b.useState(""),[m,c]=b.useState(!1),[f,h]=b.useState(null),j=b.useRef(null),x=M(),g=b.useRef(null);b.useEffect(()=>{if(g.current)return R(g.current,{reducedMotion:x}),()=>D()},[x]);const N=async s=>{var a;const i=(a=s.target.files)==null?void 0:a[0];if(i)try{const u=await i.text();d(u),c(!1),h(i.name)}catch(u){console.error("Failed to read file:",u)}},y=()=>{if(t)try{const s=V(t);if(s.errors.length===0){const i=s.sessionNames.length;k({sessionsCount:i,uploadedAt:Date.now()}),o?l(t,s.rows,s.sessionNames):n(t,s.rows,s.sessionNames)}else console.error("CSV parsing errors:",s.errors)}catch(s){console.error("Failed to parse CSV:",s)}},r=()=>{w()};return e.jsxs("div",{ref:g,className:"flex-1 relative p-6 flex items-center justify-center app-minscreen pt-[env(safe-area-inset-top)]",children:[!x&&e.jsxs(e.Fragment,{children:[e.jsx("video",{className:"fixed-fullbleed object-cover pointer-events-none",src:"/videos/landing-bg-1.optimized.mp4",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,preload:"auto","aria-hidden":"true"}),e.jsx("div",{className:"fixed-fullbleed z-[1] bg-black/70","aria-hidden":"true"}),e.jsx("div",{className:"fixed-fullbleed z-[2] bg-purple-500/30","aria-hidden":"true"})]}),e.jsx("div",{className:"max-w-md mx-auto w-full relative z-10",children:m?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"bg-green-500/20 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"material-symbols-outlined text-green-400",children:"check_circle"})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:"Upload Complete!"}),e.jsx("p",{className:"text-zinc-400 text-sm mb-6",children:"Your CSV has been successfully processed."}),e.jsx("button",{onClick:r,className:"w-full px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white text-sm font-medium rounded-xl transition-all duration-200 shadow-lg shadow-green-500/30","data-pressable":!0,children:"Return to Landing"})]}):e.jsxs("div",{className:"w-full","data-landing-update":!0,children:[e.jsxs("div",{className:"text-center text-white flex flex-col items-center gap-3",children:[e.jsx("div",{className:"bg-purple-500/20 rounded-full w-12 h-12 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-purple-400",children:"cloud_upload"})}),e.jsx("h3",{className:"text-2xl font-semibold text-white","data-landing-title":!0,children:o?"Replace CSV":"Upload CSV"}),e.jsx("p",{className:"text-white text-sm max-w-prose","data-landing-subtitle":!0,children:o?"Choose a new CSV file to replace your current workout data.":"Upload a CSV file with your workout sessions. Make sure it has the required columns."})]}),e.jsxs("div",{className:"w-full mt-8 flex flex-col items-stretch",children:[e.jsx("input",{ref:j,id:"csvFileInput",type:"file",accept:".csv",onChange:N,className:"sr-only","aria-label":"Select CSV file"}),e.jsx("label",{htmlFor:"csvFileInput",className:"btn-gradient w-full cursor-pointer select-none block text-center","data-pressable":!0,role:"button","aria-controls":"csvFileInput",children:f?"Change File":o?"Choose New CSV":"Choose CSV File"}),f&&e.jsxs("div",{className:"text-sm text-white truncate text-center mt-4","aria-live":"polite",children:["Selected: ",e.jsx("span",{className:"text-white",children:f})]}),t&&e.jsxs("div",{className:"rounded-lg p-3 border border-white/10 bg-black/20 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Preview:"}),e.jsx("div",{className:"text-xs text-white max-h-24 overflow-y-auto",children:e.jsxs("pre",{className:"whitespace-pre-wrap",children:[t.substring(0,200),"..."]})})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-12",children:[e.jsx("button",{onClick:w,className:"px-3 py-2 border border-white/20 text-xs font-medium rounded-lg text-white/90 bg-black/20 hover:bg-black/30 transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-black","data-pressable":!0,children:"Cancel"}),e.jsx("button",{onClick:y,disabled:!t,className:"px-3 py-2 border border-white/20 text-xs font-medium rounded-lg text-white hover:border-white/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-black","aria-disabled":!t,"data-pressable":!0,"data-landing-cta":!0,children:"Continue"})]})]})]})})]})}export{G as default};
