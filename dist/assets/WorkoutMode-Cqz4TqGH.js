import{b as M,u as B,j as e}from"./index-CUvJq98-.js";import{r as u}from"./vendor-nf7bT_Uh.js";function Z(h,b){const p=[];for(const i of b){const x=h.filter(d=>d.Day===i).map((d,f)=>({id:`${i}-${d.Exercise}-${f}`,sessionName:i,name:d.Exercise,sets:parseInt(d.Sets)||1,repsText:d["Reps or Time"]||"",weightText:d.Weight||"",notes:d.Notes||"",formGuidance:d["Form Guidance"]||"",muscleGroup:d["Muscle Group"]||"",mainMuscle:d["Main Muscle"]||""}));p.push({name:i,exercises:x})}return p}function V(h,b,p){try{const j=M().sessionTemplates||{},x=j[h]||{},f={...x[b]||{},...p};x[b]=f,j[h]=x,B({sessionTemplates:j})}catch(i){console.error("Failed to update template",i)}}function W(h,b,p){V(h,b,{sets:p})}function ee(h,b){return h.length?h.every(p=>(b[p.id]||[]).filter(Boolean).length>=p.sets):!1}function ne({parsedRows:h,selectedSessions:b,onClose:p}){const[i,j]=u.useState(0),[x,d]=u.useState({}),[f,_]=u.useState({}),[q,P]=u.useState(!1),[F,H]=u.useState(!0),[E,J]=u.useState(!0),[w,T]=u.useState(null),[y,v]=u.useState(""),[R,G]=u.useState({}),N=u.useRef(!1);u.useEffect(()=>{try{const s=M();s.currentSessionIndex!==void 0&&j(s.currentSessionIndex),s.currentExerciseIndex&&d(s.currentExerciseIndex),s.checkedSets&&_(s.checkedSets),s.sessionTemplates&&G(s.sessionTemplates)}catch{console.warn("Failed to load workout state from localStorage")}},[]),u.useEffect(()=>{try{B({currentSessionIndex:i,currentExerciseIndex:x,checkedSets:f})}catch(s){console.error("Failed to save workout state to localStorage",s)}},[i,x,f]);const g=u.useMemo(()=>Z(h,b),[h,b]),l=g[i]||{name:"",exercises:[]},t=l.exercises[x[l.name]||0];u.useEffect(()=>{t&&console.log("Exercise muscle data:",{name:t.name,muscleGroup:t.muscleGroup,mainMuscle:t.mainMuscle,hasMuscleGroup:!!t.muscleGroup,hasMainMuscle:!!t.mainMuscle})},[t]);const c=u.useMemo(()=>{var s;if(!t)return null;try{const a=((M().sessionTemplates||{})[l.name]||{})[t.name]||{},m=((s=R[l.name])==null?void 0:s[t.name])||{};return{...t,sets:m.sets||a.sets||t.sets,repsText:m.repsText||a.repsText||t.repsText,weightText:m.weightText||a.weightText||t.weightText,notes:m.notes||a.notes||t.notes,formGuidance:m.formGuidance||a.formGuidance||t.formGuidance,displayName:m.displayName||a.displayName||t.name,muscleGroup:t.muscleGroup,mainMuscle:t.mainMuscle}}catch{return console.warn("Failed to load template data"),t}},[t,l.name,R]),K=u.useMemo(()=>{if(!l.exercises.length)return!1;const s={};return l.exercises.forEach(n=>{var r;s[n.id]=((r=f[l.name])==null?void 0:r[n.id])||[]}),ee(l.exercises,s)},[l.exercises,f,l.name]),A=u.useMemo(()=>{if(!l.exercises.length)return 0;let s=0,n=0;return l.exercises.forEach(r=>{var a;s+=r.sets;const o=((a=f[l.name])==null?void 0:a[r.id])||[];n+=o.filter(Boolean).length}),s>0?Math.round(n/s*100):0},[l.exercises,f,l.name]),D=s=>{d(n=>({...n,[l.name]:s}))},L=(s,n,r,o)=>{var a;if(_(m=>{const S=m[s]||{},C=[...S[n]||[]];return C[r]=o,{...m,[s]:{...S,[n]:C}}}),o&&t){const m=[...((a=f[s])==null?void 0:a[n])||[]];m[r]=o,Array.from({length:t.sets},(k,C)=>m[C]||!1).every(Boolean)&&setTimeout(()=>{const k=x[l.name]||0;k<l.exercises.length-1&&D(k+1)},500)}},O=()=>{if(K){const r={...M().sessionCompletion||{},[l.name]:{completed:!0,completedAt:Date.now()}};B({sessionCompletion:r}),P(!0),setTimeout(()=>P(!1),2e3),i<g.length-1?(j(i+1),d(o=>({...o,[g[i+1].name]:0}))):p()}},Q=()=>{i<g.length-1&&(j(i+1),d(s=>({...s,[g[i+1].name]:0})))},X=()=>{i>0&&(j(i-1),d(s=>({...s,[g[i-1].name]:0})))},Y=s=>{t&&s>0&&(W(l.name,t.name,s),G(n=>{var r;return{...n,[l.name]:{...n[l.name],[t.name]:{...(r=n[l.name])==null?void 0:r[t.name],sets:s}}}}))},U=(s,n)=>{t&&(V(l.name,t.name,{[s]:n}),G(r=>{var o;return{...r,[l.name]:{...r[l.name],[t.name]:{...(o=r[l.name])==null?void 0:o[t.name],[s]:n}}}}))},z=()=>{if(!(!w||!t)){if(w==="sets"){const s=parseInt(y);!isNaN(s)&&s>0&&Y(s)}else w==="reps"?U("repsText",y):w==="weight"&&U("weightText",y);T(null),v("")}},I=s=>{var r;T(s);const n=c;s==="sets"?v(((r=n==null?void 0:n.sets)==null?void 0:r.toString())||"1"):s==="reps"?v((n==null?void 0:n.repsText)||""):s==="weight"&&v((n==null?void 0:n.weightText)||"")},$=()=>{T(null),v("")};return g.length===0?e.jsx("div",{className:"app-minscreen pt-[var(--safe-top)] bg-black",children:e.jsx("div",{className:"max-w-[430px] mx-auto h-full flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"No Sessions Selected"}),e.jsx("p",{className:"text-zinc-400 mb-6",children:"Please select at least one session to view workouts."}),e.jsx("button",{onClick:p,className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg shadow-blue-500/30",children:"Choose Sessions"})]})})}):e.jsxs("div",{className:"workout-mode-full-height flex-1 flex flex-col bg-zinc-900 text-white",children:[g.length>1&&e.jsx("div",{className:"mt-4 px-4 py-2 border-b border-zinc-800 bg-zinc-900 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:X,disabled:i===0,className:"shrink-0 flex items-center text-xs sm:text-sm text-zinc-400 hover:text-white disabled:text-zinc-600 disabled:cursor-not-allowed transition-colors","data-pressable":!0,children:[e.jsx("span",{className:"material-symbols-outlined mr-1",children:"chevron_left"}),e.jsx("span",{className:"inline sm:hidden",children:"Previous"}),e.jsx("span",{className:"hidden sm:inline",children:"Previous Session"})]}),e.jsxs("div",{className:"flex-1 min-w-0 text-center px-1",children:[e.jsxs("span",{className:"block text-xs sm:text-sm font-medium text-white leading-tight whitespace-nowrap",children:["Session ",i+1," of ",g.length]}),e.jsx("div",{className:"text-[11px] sm:text-xs text-zinc-400 mt-1 truncate max-w-full",children:l.name})]}),e.jsxs("button",{onClick:Q,disabled:i===g.length-1,className:"shrink-0 flex items-center text-xs sm:text-sm text-zinc-400 hover:text-white disabled:text-zinc-600 disabled:cursor-not-allowed transition-colors","data-pressable":!0,children:[e.jsx("span",{className:"inline sm:hidden",children:"Next"}),e.jsx("span",{className:"hidden sm:inline",children:"Next Session"}),e.jsx("span",{className:"material-symbols-outlined ml-1",children:"chevron_right"})]})]})}),e.jsxs("div",{className:"mt-4 px-4 py-2 border-b border-zinc-800 flex-shrink-0",children:[e.jsx("div",{className:"w-full bg-zinc-800 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full transition-all duration-300 shadow-lg shadow-purple-500/30",style:{width:`${A}%`}})}),e.jsx("div",{className:"text-center mt-1",children:e.jsxs("span",{className:"text-sm text-zinc-400 font-medium",children:[A,"% Complete"]})})]}),e.jsx("main",{className:"px-4 py-3 pb-0 space-y-3 overflow-y-auto flex-1 bg-zinc-900",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 p-4 text-center",children:[e.jsx("h1",{className:"text-3xl font-extrabold mb-3 text-white",children:(c==null?void 0:c.name)||t.name}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[t.muscleGroup?e.jsx("div",{className:"bg-purple-500/20 text-purple-400 text-xs font-medium px-3 py-1 rounded-full inline-block border border-purple-500/30",children:t.muscleGroup}):null,t.mainMuscle?e.jsx("div",{className:"bg-blue-500/20 text-blue-400 text-xs font-medium px-3 py-1 rounded-full inline-block border border-blue-500/30",children:t.mainMuscle}):null,!t.muscleGroup&&!t.mainMuscle?e.jsx("div",{className:"bg-zinc-500/20 text-zinc-400 text-xs font-medium px-3 py-1 rounded-full inline-block border border-zinc-500/30",children:"Muscle Info"}):null]})]}),e.jsx("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 p-4 mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm text-zinc-400 font-medium",children:"Reps"}),w==="reps"?e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",value:y,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"?(s.preventDefault(),z()):s.key==="Escape"&&(s.preventDefault(),N.current=!0,$())},onBlur:()=>{if(N.current){N.current=!1;return}z()},className:"w-full text-center font-bold text-xl border border-zinc-700 bg-zinc-800 text-white rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"6-8",autoFocus:!0})}):e.jsx("button",{onClick:()=>I("reps"),className:"w-full text-xl font-extrabold mt-1 hover:bg-zinc-800 rounded-xl py-3 transition-colors min-h-[3rem] flex items-center justify-center text-white",children:(()=>{const s=(c==null?void 0:c.repsText)||t.repsText||"6-8";if(/\d/.test(s)){const r=s.trim().split(/[-–—]/);if(r.length>=2&&/^\d+$/.test(r[0].trim())&&/^\d+$/.test(r[1].trim()))return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:r[0].trim()}),e.jsx("span",{className:"text-base font-medium mx-1",children:"-"}),e.jsx("span",{children:r[1].trim()})]});{const o=s.match(/(\d+)\s*[-–—]\s*(\d+)/);if(o){const a=o[1],m=o[2],S=s.replace(o[0],"").trim();return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a}),e.jsx("span",{className:"text-base font-medium mx-1",children:"-"}),e.jsx("span",{children:m}),S&&e.jsx("span",{className:"text-base font-medium ml-1",children:S})]})}}}return e.jsx("span",{className:"text-base font-medium px-2",children:s})})()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm text-zinc-400 font-medium",children:"Weight"}),w==="weight"?e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",value:y,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"?(s.preventDefault(),z()):s.key==="Escape"&&(s.preventDefault(),N.current=!0,$())},onBlur:()=>{if(N.current){N.current=!1;return}z()},className:"w-full text-center font-bold text-xl border border-zinc-700 bg-zinc-800 text-white rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"100 lb",autoFocus:!0})}):e.jsx("button",{onClick:()=>I("weight"),className:"w-full text-xl font-extrabold mt-1 hover:bg-zinc-800 rounded-xl py-3 transition-colors min-h-[3rem] flex items-center justify-center text-white",children:(()=>{const s=(c==null?void 0:c.weightText)||t.weightText||"100 lb";if(/\d/.test(s)){const r=s.trim().split(/\s+/);if(r.length>=2&&/^\d+$/.test(r[0]))return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:r[0]}),e.jsx("span",{className:"text-base font-medium ml-1",children:r.slice(1).join(" ")})]});{const o=s.match(/(\d+)/);if(o){const a=o[1],m=s.replace(a,"").trim();return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a}),m&&e.jsx("span",{className:"text-base font-medium ml-1",children:m})]})}}}return e.jsx("span",{className:"text-base font-medium px-2",children:s})})()})]})]})}),e.jsx("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 p-4 mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm text-zinc-400 font-medium",children:"Sets"}),w==="sets"?e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",value:y,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"?(s.preventDefault(),z()):s.key==="Escape"&&(s.preventDefault(),N.current=!0,$())},onBlur:()=>{if(N.current){N.current=!1;return}z()},className:"w-full text-center font-bold text-xl border border-zinc-700 bg-zinc-800 text-white rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"3",autoFocus:!0})}):e.jsx("button",{onClick:()=>I("sets"),className:"w-full text-xl font-extrabold mt-1 hover:bg-zinc-800 rounded-xl py-3 transition-colors min-h-[3rem] flex items-center justify-center text-white",children:(()=>{const s=(c==null?void 0:c.sets)||t.sets||1;if(/\d/.test(s.toString())){const r=s.toString().match(/(\d+)/);if(r){const o=r[1],a=s.toString().replace(o,"").trim();return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:o}),a&&e.jsx("span",{className:"text-base font-medium ml-1",children:a})]})}}return e.jsx("span",{className:"text-base font-medium px-2",children:s})})()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm text-zinc-400 font-medium",children:"Completed"}),e.jsx("div",{className:"mt-1",children:e.jsx("div",{className:"flex justify-center space-x-3",children:Array.from({length:Math.max(1,(c==null?void 0:c.sets)||t.sets||1)},(s,n)=>{var o,a;const r=((a=(o=f[l.name])==null?void 0:o[t.id])==null?void 0:a[n])||!1;return e.jsx("button",{onClick:()=>L(l.name,t.id,n,!r),className:`rounded-full w-14 h-14 flex items-center justify-center font-extrabold text-xl transition-colors ${r?"bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-lg shadow-purple-500/30":"bg-zinc-800 text-zinc-300 hover:bg-zinc-700 hover:text-white border border-zinc-700"}`,children:n+1},n)})})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mb-0",children:[e.jsxs("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>H(!F),className:"w-full p-4 text-left flex items-center justify-between hover:bg-zinc-800 transition-colors",children:[e.jsx("h2",{className:"text-base font-semibold text-white",children:"Notes"}),e.jsx("span",{className:`material-symbols-outlined text-zinc-400 transition-transform ${F?"rotate-0":"rotate-180"}`,children:"expand_more"})]}),!F&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"text-sm text-zinc-300 p-3 bg-zinc-800 rounded-lg border border-zinc-700",children:(c==null?void 0:c.notes)||t.notes||""})})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>J(!E),className:"w-full p-4 text-left flex items-center justify-between hover:bg-zinc-800 transition-colors",children:[e.jsx("h2",{className:"text-base font-semibold text-white",children:"Form"}),e.jsx("span",{className:`material-symbols-outlined text-zinc-400 transition-transform ${E?"rotate-0":"rotate-180"}`,children:"expand_more"})]}),!E&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"text-sm text-zinc-300 p-3 bg-zinc-800 rounded-lg border border-zinc-700",children:(c==null?void 0:c.formGuidance)||t.formGuidance||""})})]})]})]}):e.jsx("div",{className:"h-full flex items-center justify-center text-zinc-400",children:"No exercises in this session"})}),e.jsx("footer",{className:"bg-zinc-900 border-t border-zinc-800 pt-4 pb-4 px-6",style:{paddingBottom:"max(env(safe-area-inset-bottom), 12px)"},children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>D((x[l.name]||0)-1),disabled:(x[l.name]||0)===0,className:"flex-1 bg-zinc-800 text-zinc-300 font-semibold py-3 rounded-xl hover:bg-zinc-700 hover:text-white disabled:bg-zinc-900 disabled:text-zinc-600 disabled:cursor-not-allowed transition-colors border border-zinc-700",children:"Previous Exercise"}),K?e.jsx("button",{onClick:O,className:"flex-1 bg-gradient-to-r from-purple-500 to-blue-500 text-white font-semibold py-3 rounded-xl hover:from-purple-600 hover:to-blue-600 transition-all duration-200 shadow-lg shadow-blue-500/30","data-pressable":!0,children:i<g.length-1?"Next Session":"Complete Workout"}):e.jsx("button",{onClick:()=>D((x[l.name]||0)+1),disabled:(x[l.name]||0)===l.exercises.length-1,className:"flex-1 bg-gradient-to-r from-purple-500 to-blue-500 text-white font-semibold py-3 rounded-xl hover:from-purple-600 hover:to-blue-600 disabled:from-zinc-600 disabled:to-zinc-600 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-blue-500/30","data-pressable":!0,children:"Next Exercise"})]})}),q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-pulse",children:e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-emerald-600 text-white px-8 py-6 rounded-2xl shadow-2xl transform transition-all duration-500 ease-out scale-100 border border-green-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center animate-bounce",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-white",children:"check_circle"})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 animate-pulse",children:"Session Completed! 🎉"}),e.jsx("p",{className:"text-green-100 text-sm",children:"Great job! Keep up the momentum!"}),e.jsx("div",{className:"mt-4 w-full bg-white bg-opacity-20 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-white h-2 rounded-full animate-pulse",style:{width:"100%"}})})]})})})]})}export{ne as default};
